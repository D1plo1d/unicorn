# Upstart Unicorn Conf
<% unicorn = "bundle exec unicorn -c #{@name} -E #{@rack_env}"%>
<% unicorn = "su #{@forked_user} -c \"#{unicorn}\"" if @forked_user %>

start on (filesystem and net-device-up IFACE=lo)
stop on runlevel [!2345]

respawn

script
    cd <%= @working_directory %>
    <%= unicorn %>
    flock -x 0 < <%= @pid %>.lock
end script
